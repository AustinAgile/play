<!DOCTYPE html>
<meta charset="utf-8">

<body>
  <!-- <canvas id="c"></canvas> -->
  <script src="./js/lodash.min.js"></script>
  <script type="module">
    import * as THREE from '../three/build/three.module.js';
    import {EffectComposer} from '../three/examples/jsm/postprocessing/EffectComposer.js';
    import { RenderPass } from "../three/examples/jsm/postprocessing/RenderPass.js";
    import { CustomOutlinePass } from "./three/CustomOutlinePass.js";
    import { ShaderPass } from "../three/examples/jsm/postprocessing/ShaderPass.js";
    import { FXAAShader } from "../three/examples/jsm/shaders/FXAAShader.js";
    import {line} from "./three/line.js";
    import * as shit from './three/plane1.js';
    // import * as alt from './three/shape.js';
    import * as alt0 from './three/shape0.js';
    import * as utilm from './three/util.js';
    // import * as zzz from './three/view.js';
    // import * as sq from './three/square.js';
    // import * as ex from './three/extrude.js';

    import * as doug from "./three/test.js";

    // var view = new zzz.view();
    var builder = new shit.builder();
    // var shaper = new alt.shaper();
    var shaper0 = new alt0.shaper();
    var util = new utilm.util();
    util.constructor();

    // var backPlane = new alt0.shaper();
    // console.log(backPlane);
    // shaper.constructor();
    shaper0.constructor();

    function main() {
      // const canvas = document.querySelector('#c');
      // const renderer = new THREE.WebGLRenderer({canvas});
      const renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setSize(1800, 900);
      // renderer.shadowMap.enabled = true;
      // renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      // renderer.shadowMap.renderReverseSided = false;
      document.body.appendChild( renderer.domElement );

      // Set up post processing
      // Create a render target that holds a depthTexture so we can use it in the outline pass
      // See: https://threejs.org/docs/index.html#api/en/renderers/WebGLRenderTarget.depthBuffer
      const depthTexture = new THREE.DepthTexture();
      const renderTarget = new THREE.WebGLRenderTarget(
        window.innerWidth,
        window.innerHeight,
        {
          depthTexture: depthTexture,
          depthBuffer: true,
        }
      );

      const fov = 80;
      const aspect = 2;  // the canvas default
      const near = 1;
      const far = 7000;
      const camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
      camera.position.set(750,-1500,1000);
      camera.up = new THREE.Vector3(0,0,1);
      camera.lookAt(new THREE.Vector3(750,0,1000));
      // console.log(camera);


      var scene = new THREE.Scene();
      scene.background = new THREE.Color("#088a40");

      // Initial render pass.
      const composer = new EffectComposer(renderer, renderTarget);
      const pass = new RenderPass(scene, camera);
      composer.addPass(pass);

      // // Outline pass.
      // const customOutline = new CustomOutlinePass(
      //   new THREE.Vector2(window.innerWidth, window.innerHeight),
      //   scene,
      //   camera
      // );
      // composer.addPass(customOutline);
      // // Antialias pass.
      // const effectFXAA = new ShaderPass(FXAAShader);
      // effectFXAA.uniforms["resolution"].value.set(
      //   1 / window.innerWidth,
      //   1 / window.innerHeight
      // );
      // composer.addPass(effectFXAA);

      // shaper.setScene(scene);
      shaper0.setScene(scene);

      // //South Side
      // var h = 0;
      // shaper.addHole([157, 385], [90, 185]);//
      // shaper.addHole([714, 385], [90, 185]);//
      // shaper.addHole([157, 750], [90, 185]);//
      // shaper.addHole([714, 750], [90, 185]);//
      // shaper.planeY([942,  0, 1033],[  0,   0,   0], 0xfcd690);
      // h+=wallH;
      //
      // //Cornice
      // shaper.planeY([952,  5,    0],[ -5,  -5,   h], 0xfffdf2);
      // shaper.planeY([952,  0,    8],[ -5,  -5,   h], 0xfffdf2);
      // h+=8;
      //
      // shaper.planeY([962,  5,    0],[-10, -10,   h], 0xfffdf2);
      // shaper.planeY([962,  0,   18],[-10, -10,   h], 0xfffdf2);
      // h+=18;
      //
      // // shaper.planeY([962,  5,    5],[-10, -10,   h], 0xfffdf2, true);//bevel 1
      // shaper.trapY([[962,0,0],[967,5,5],[-5,5,5]],[-10, -10,   h], 0xfffdf2, true);//bevel 1
      // h += 5;
      //
      // shaper.planeY([982,  5,    0],[-20, -20,   h], 0xfffdf2);
      // shaper.planeY([982,  0,    6],[-20, -20,   h], 0xfffdf2);
      // h += 6;
      //
      // // shaper.planeY([982,  8,    6],[-20, -20,   h], 0xffff00, true);//bevel 2
      // shaper.trapY([[982,  0,    0],[990,  8,    6],[-8,  8,    6]],[-20, -20,   h], 0xfffdf2, true);//bevel 2????
      // h += 6;
      // shaper.planeY([998,  0,    6],[-28, -28,   h], 0xfffdf2);
      // h+=6;
      //
      // // shaper.planeY([1078, 40,    0],[-68, -68,   h], 0xff0000);
      // shaper.trapY([[1078, 0,    0],[1038, 40,    0],[40, 40,    0]],[-68, -68,   h], 0xfffdf2);//????
      // shaper.planeY([1078,  0,   18],[-68, -68,   h], 0xfffdf2);
      // h+=18;
      //
      // console.log(corniceW);
      // shaper.trapY([[1078,  0,    0],[1078-corniceW,  corniceW,    0],[corniceW,  corniceW,  0]],[ -68,  -corniceW,   h], 0xfffdf2);
      // shaper.planeY([942,  0,    corniceH],[ 0,  0,   wallH], 0xfffdf2);
      //
      // //South Side Kitchen
      // var h = 0;
      // shaper.addHole([70, 400], [30, 30]);//door
      // shaper.addHole([293, 385], [90, 135]);//door
      // shaper.planeY([393,  0, 630],[  0,   942,   0], 0xfcd690);
      // h+=wallH;
      //
      // //West Side
      // shaper.addHole([133, 5], [110, 214]);//door
      // shaper.planeX([900,  0, 340],[  600,   942,   290], 0xfcd690);//Lower wall
      //
      // shaper.addHole([733, 100], [90, 125]);//door
      // shaper.planeX([1500,  0, 403],[  0,   942,   630], 0xfcd690);//Upper wall
      //
      // shaper.planeX([1440,  0, corniceH],[  60,   942,   wallH], 0xfcd690);//Top wall// attempt to rotate this wall a bit more
      //
      // //West Cornice
      // shaper.planeX([65,  5,    0],[ -5,  942,   h], 0xfffdf2);
      // shaper.planeX([65,  0,    8],[ -5,  947,   h], 0xfffdf2);
      // h+=8;
      // shaper.planeX([70,  5,    0],[-10, 947,   h], 0xfffdf2);
      // shaper.planeX([70,  0,   18],[-10, 952,   h], 0xfffdf2);
      // h+=18;
      // // shaper.planeX([70,  5,    5],[-10, 952,   h], 0xfffdf2, false);//bevel 1
      // shaper.trapX([[70,  0,    0],[70,  5,    5],[-5,  5,    5]],[-10, 952,   h], 0xfffdf2, false);//bevel 1
      // h += 5;
      //
      // shaper.planeX([80,  5,    0],[-20, 957,   h], 0xfffdf2);
      // shaper.planeX([80,  0,    6],[-20, 962,   h], 0xfffdf2);
      // h += 6;
      //
      // // shaper.planeX([80,  8,    6],[-20, 962,   h], 0xfffdf2, false);//bevel 2
      // shaper.trapX([[80,  0,    0],[80,  8,    6],[-8,  8,    6]],[-20, 962,   h], 0xfffdf2, false);//bevel 2
      // h += 6;
      // shaper.planeX([88,  0,    6],[-28, 970,   h], 0xfffdf2);
      // h+=6;
      //
      // // shaper.planeX([128, 40,    0],[-68, 970,   h], 0xff0000);
      // shaper.trapX([[88, 0,    0],[88, 40,    0],[-40, 40,    0]],[-28, 970,   h], 0xfffdf2);
      // shaper.planeX([128,  0,   18],[-68, 1010,   h], 0xfffdf2);
      // h+=18;
      //
      // shaper.trapX([[60,  0,    0],[60,  corniceW,    0],[-68,  corniceW,    0]],[ 0,  942,   h], 0xfffdf2);
      // shaper.planeX([60,  0,    corniceH],[ 0,  942,   wallH], 0xfffdf2);

      // shaper0.addHole([200, 100], [200, 100]);//door
      // shaper0.main2([[900,0,0],[900,500,0],[0,500,0]],[ 0, 0, 0], [ 90, 0, 0], 0xfffdf2);

      var materials = {
        stucco:   {f: {color: 0xfcd690, opacity: 1}, b: {color: 0xff0000, opacity: .5}},
        cornice:  {f: {color: 0xfffdf2, opacity: 1}, b: {color: 0xff0000, opacity: .5}},
        plaster:  {f: {color: 0xb3b3b3, opacity: 1}, b: {color: 0xffff00, opacity: .5}},
        floor:    {f: {color: 0xb58148, opacity: 1}, b: {color: 0x5555ff, opacity: .5}},
        debug:    {f: {color: 0xff0000, opacity: 1}, b: {color: 0x0000ff, opacity: 1}}
      };


      function cornice(wallSystem, delta, angle) {
        wallSystem
          .addExteriorSurface(new doug.Surface("cornice1H").setOn("main").setSize({dw: delta.dw, h: 0}).setBevel({y: 5, miters:angle}).setOffset({dx: delta.dx}))
          .addExteriorSurface(new doug.Surface("cornice1V").setOn("cornice1H").setSize({h: 8}))
          .addExteriorSurface(new doug.Surface("cornice2H").setOn("cornice1V").setSize({h: 0}).setBevel({y: 5, miters:angle}))
          .addExteriorSurface(new doug.Surface("cornice2V").setOn("cornice2H").setSize({h: 18}))
          .addExteriorSurface(new doug.Surface("cornice3B").setOn("cornice2V").setSize({h: 5}).setBevel({y: 5, miters:angle}))
          .addExteriorSurface(new doug.Surface("cornice4H").setOn("cornice3B").setSize({h: 0}).setBevel({y: 5, miters:angle}))
          .addExteriorSurface(new doug.Surface("cornice4V").setOn("cornice4H").setSize({h: 6}))
          .addExteriorSurface(new doug.Surface("cornice5B").setOn("cornice4V").setSize({h: 6}).setBevel({y: 8, miters:angle}))
          .addExteriorSurface(new doug.Surface("cornice5V").setOn("cornice5B").setSize({h: 6}))
          .addExteriorSurface(new doug.Surface("cornice6H").setOn("cornice5V").setSize({h: 0}).setBevel({y: 40, miters:angle}))
          .addExteriorSurface(new doug.Surface("cornice6V").setOn("cornice6H").setSize({h: 18}))
          .addExteriorSurface(new doug.Surface("cornice7H").setOn("cornice6V").setSize({h: 0}).setBevel({y: -68, miters:angle}).flip())
        ;
      }

      var ground = 0;
      var level0Z = ground;
      var level0H = 278;
      var level0CeilingThickness = 40;
      var level1Z = 289; //level0Z+level0H+level0CeilingThickness;
      var level1H = 342;
      var level1CeilingThickness = 20;
      var level2Z = level1Z + level1H+level1CeilingThickness;
      var level2H = 337;
      var level2CeilingThickness = 20;
      var totalH = level2Z+level2H+level2CeilingThickness;

      class bigWindow extends doug.Window {size = {w: 200, h: 100};};
      class smallWindow extends doug.Window {size = {w: 100, h: 50};};
      class Window90x190 extends doug.Window {size = {w: 90, h: 190};};
      class Door90x285 extends doug.Window {size = {w: 90, h: 285};};
      class Door95x205 extends doug.Window {size = {w: 95, h: 205};};
      class Window90x185 extends doug.Window {size = {w: 90, h: 185};};

      class Floor extends doug.Surface {color = materials.floor};
      class Ceiling extends doug.Surface {color = materials.plaster};

      var thick = {
        east: {L0: 70, L1: 70, L2: 70},
        south: {L0: 75, L1: 75, L2: 75},
        west: {L0: 60, L1: 60, L2: 60},
        north: {L0: 65, L1: 65, L2: 65},
      };
      var rooms = {
        L0: {cellar: {z: 0, h: 270, w: 488, y: 750}},
        L1: {living: {z: 289, h: 342, w: 536, y: 510}},
        L2: {bedroom: {z: 651, h: 337, w: 545, y: 460}}
      };


      function roomWallSize(parameters) {
        switch (parameters.side) {
          case "east":
          case "west":
            return {w: rooms[parameters.level][parameters.room].w, h: rooms[parameters.level][parameters.room].h};
          case "north":
          case "south":
            return {w: rooms[parameters.level][parameters.room].y, h: rooms[parameters.level][parameters.room].h};
        }
      }
      function roomWallOffset(parameters, offset) {
        if (!offset) {offset = {x: 0, y: 0, z: 0};}
        switch (parameters.sides.y) {
          case "east":
          return _.mergeWith(offset,
            {x: thick[parameters.sides.x][parameters.level], y: -thick[parameters.sides.y][parameters.level], z: rooms[parameters.level][parameters.room].z},
            function(result, value) {return result + value;}
          );
          case "south":
          return _.mergeWith(offset,
            {x: -thick[parameters.sides.x][parameters.level], y: -thick[parameters.sides.y][parameters.level], z: rooms[parameters.level][parameters.room].z},
            function(result, value) {return result + value;}
          );
        }
      }
      // console.log(roomWallSize({level: "L0", room: "cellar", side: "east"}));
      // console.log(roomWallOffset({level: "L0", room: "cellar", side: "east"}, {x: 100, y: 0, z: 0}));

      //East wall
      var wallH = 1033;
      var eastWallWidth = 1500;
      var eastWall = new doug.WallSystem("East Wall")
        .setPlane(new doug.Plane().setFacingDirection([0,-1,0]).setOriginOffset([0,0,0]).setRotationZ(0))
        .setExteriorMaterial(materials.stucco)
        .addExteriorSurface(new doug.Surface("main")
          .setSize({w: eastWallWidth, h: wallH})
          .setOffset({x: 0, y: 0, z: ground})
          .setWindows(new doug.Windows([
            "cellar1", "cellar2", "cellar3", "cellar4", "cellar5",
            "leftL1LR", "rightL1LR", "stairL1", "leftL1BR", "rightL1BR",
            "leftL2LR", "rightL2LR", "stairL2", "leftL2BR", "rightL2BR"
          ]))
        )
        .setInteriorMaterial(materials.plaster)
        .addInteriorSurface(new doug.Surface("level0")
          .setSize(roomWallSize({level: "L0", room: "cellar", side: "east"}))
          .setOffset(roomWallOffset({level: "L0", room: "cellar", sides: {x: "south", y: "east"}}, {x: 0, y: 0, z: 0}))
          .setWindows(new doug.Windows(["cellar1", "cellar2"]).setJambsAll())
        )
        .addInteriorSurface(new doug.Surface("level1")
          .setSize(roomWallSize({level: "L1", room: "living", side: "east"}))
          .setOffset(roomWallOffset({level: "L1", room: "living", sides: {x: "south", y: "east"}}, {x: 0, y: 0, z: 0}))
          .setWindows(new doug.Windows(["leftL1LR", "rightL1LR"]).setJambsAll())
        )
        .addInteriorSurface(new doug.Surface("level2")
          .setSize(roomWallSize({level: "L2", room: "bedroom", side: "east"}))
          .setOffset(roomWallOffset({level: "L2", room: "bedroom", sides: {x: "south", y: "east"}}, {x: 0, y: 0, z: 0}))
          .setWindows(new doug.Windows(["leftL2LR", "rightL2LR"]).setJambsAll())
        )
        .addWindow(new doug.Window("cellar1").setOffset({x: 172, z: 150}).setSize({w: 70, h: 60}))
        .addWindow(new doug.Window("cellar2").setOffset({dx: 210, z: 150, window: "cellar1"}).setSize({w: 60, h: 60}))
        .addWindow(new doug.Window("cellar3").setOffset({x: 703, z: 10}).setSize({w: 113, h: 224}))
        .addWindow(new doug.Window("cellar4").setOffset({dx: 210, z: 153, window: "cellar3"}).setSize({w: 40, h: 50}))
        .addWindow(new doug.Window("cellar5").setOffset({dx: 195, z: 10, window: "cellar4"}).setSize({w: 75, h: 193}))
        .addWindow(new Window90x190("leftL1LR").setOffset({x: 165, z: 385}))
        .addWindow(new Door90x285("rightL1LR").setOffset({dx: 165, z: 290, window: "leftL1LR"}))
        .addWindow(new Window90x190("stairL1").setOffset({dx: 186, z: 385, window: "rightL1LR"}))
        .addWindow(new Door90x285("leftL1BR").setOffset({dx: 186, z: 290, window: "stairL1"}))
        .addWindow(new Window90x190("rightL1BR").setOffset({dx: 165, z: 385, window: "leftL1BR"}))
        .addWindow(new Window90x190("leftL2LR").setOffset({x: 165, z: 750}))
        .addWindow(new Window90x190("rightL2LR").setOffset({dx: 165, z: 750, window: "leftL2LR"}))
        .addWindow(new Window90x190("stairL2").setOffset({dx: 186, z: 750, window: "rightL2LR"}))
        .addWindow(new Window90x190("leftL2BR").setOffset({dx: 186, z: 750, window: "stairL2"}))
        .addWindow(new Window90x190("rightL2BR").setOffset({dx: 165, z: 750, window: "leftL2BR"}))
        .setExteriorMaterial(materials.cornice)
      ;
      cornice(eastWall, {dw: 0, dx: 0}, {angle:{left:-45, right:0}});
      shaper0.wallSystem(eastWall);


      var bedroomL1 = new doug.WallSystem("Bedroom L1")
        .setPlane(new doug.Plane().setFacingDirection([0,-1,0]).setOriginOffset([901,70,289]).setRotationZ(0))
        .setInteriorMaterial(materials.plaster)
        .addWindow(new Door95x205("door").setOffset({x: 40, z: 0}))
        .addWindow(new doug.Window("closet").setSize({w: 97, h: 205}).setOffset({x: 279, z: 0}))
        .addWindow(new doug.Window("nookie").setSize({w: 137, h: 205}).setOffset({x: 10, z: 50}))
        .addInteriorSurface(new doug.Surface("east")
          .setSize({w: 493, h: 329})
          .setWindows(new doug.Windows(["leftL1BR", "rightL1BR"]).setWallSystem(eastWall).setJambsAll())
        )
        .addInteriorSurface(new doug.Surface("south")
          .setSize({w: 450, h: 329})
          .setRotation({x: 0, y: 0, z: 90})
          .setWindows(new doug.Windows(["closet"]))
          .flip()
        )
        .addInteriorSurface(new doug.Surface("south nook 1")
          .setSize({w: 35, h: 205})
          .setOffset({x: 0, y: -279, z: 0})
          .setRotation({x: 0, y: 0, z: 180})
          .flip()
        )
        .addInteriorSurface(new doug.Surface("south nook 2")
          .setSize({w: 97, h: 205})
          .setOffset({x: -35, y: -279, z: 0})
          .setRotation({x: 0, y: 0, z: 90})
          .flip()
        )
        .addInteriorSurface(new doug.Surface("south nook 3")
          .setSize({w: 35, h: 205})
          .setOffset({x: 0, y: -(279+97), z: 0})
          .setRotation({x: 0, y: 0, z: 180})
        )
        .addInteriorSurface(new doug.Surface("west")
          .setSize({w: 501, h: 329})
          .setOffset({x: 0, y: -450, z: 0})
          .setWindows(new doug.Windows(["door"]))
          .flip()
        )
        .addInteriorSurface(new doug.Surface("north")
          .setSize({w: 447, h: 329})
          .setOffset({x: 493, y: 0, z: 0})
          .setRotation({x: 0, y: 0, z: 90})
          .setWindows(new doug.Windows(["nookie"]))
        )
        // .addHorizontalSurface(new Floor("floor").setProperties({
        //   size: {w: 493, h: 447},
        // }))
        // .addHorizontalSurface(new Floor("closet floor").setProperties({
        //   size: {w: 35, h: 97},
        //   offset: {x: -35, y: -279, z: 0},
        // }))
        // .addInteriorHorizontalSurface(new Floor("ceiling").setProperties({
        //   size: {w: 493, h: 447},
        //   offset: {x: 0, y: 0, z: 329},
        //   rotation: {x: -90, y: 0, z: 0}
        // }).flip())
      ;
      shaper0.wallSystem(bedroomL1);


      //Floors
      var floors = new doug.WallSystem("Floor")
        .setPlane(new doug.Plane().setFacingDirection([0,0,1]).setOriginOffset([0,0,0]).setRotationZ(0))
        .addInteriorHorizontalSurface(new Floor("floor0")
          .setSize({w: rooms.L0.cellar.w, h: rooms.L0.cellar.y})
          .setOffset(roomWallOffset({level: "L0", room: "cellar", sides: {x: "south", y: "east"}}))
        )
        .addInteriorHorizontalSurface(new Ceiling("ceiling0")
          .setSize({w: rooms.L0.cellar.w, h: rooms.L0.cellar.y})
          .setOffset(roomWallOffset({level: "L0", room: "cellar", sides: {x: "south", y: "east"}}, {x: 0, y: 0, z: rooms.L0.cellar.h}))
          .flip()
        )
        .addInteriorHorizontalSurface(new Floor("floor1")
          .setSize({w: rooms.L1.living.w, h: rooms.L1.living.y})
          .setOffset(roomWallOffset({level: "L1", room: "living", sides: {x: "south", y: "east"}}))
        )
        .addInteriorHorizontalSurface(new Ceiling("ceiling1")
          .setSize({w: rooms.L1.living.w, h: rooms.L1.living.y})
          .setOffset(roomWallOffset({level: "L1", room: "living", sides: {x: "south", y: "east"}}, {x: 0, y: 0, z: rooms.L1.living.h}))
          .flip()
        )
        .addInteriorHorizontalSurface(new Floor("floor2")
          .setSize({w: rooms.L2.bedroom.w, h: rooms.L2.bedroom.y})
          .setOffset(roomWallOffset({level: "L2", room: "bedroom", sides: {x: "south", y: "east"}}))
        )
        .addInteriorHorizontalSurface(new Ceiling("ceiling2")
          .setSize({w: rooms.L2.bedroom.w, h: rooms.L2.bedroom.y})
          .setOffset(roomWallOffset({level: "L2", room: "bedroom", sides: {x: "south", y: "east"}}, {x: 0, y: 0, z: rooms.L2.bedroom.h}))
          .flip()
        )
      ;
      shaper0.wallSystem(floors);

      //South Wall
      var southWallWidth = 942;
      var southWall = new doug.WallSystem("South Wall")
        .setPlane(new doug.Plane().setFacingDirection([0,-1,0]).setOriginOffset([0,942,0]).setRotationZ(90))
        .addWindow(new Window90x185("w1").setOffset({x: 157, z: 385}))
        .addWindow(new Window90x185("w2").setOffset({x: 714, z: 385}))
        .addWindow(new Window90x185("w3").setOffset({x: 157, z: 750}))
        .addWindow(new Window90x185("w4").setOffset({x: 714, z: 750}))
        .addWindow(new doug.Window("Kitchen1").setOffset({x: -350, z: 100}).setSize({w: 30, h:30}))
        .addWindow(new doug.Window("Kitchen2").setOffset({x: 293, z: 384}).setSize({w: 90, h:135}))
        .setExteriorMaterial(materials.stucco)
        .addExteriorSurface(new doug.Surface("main")
          .setSize({w: southWallWidth, h: wallH})
          .setOffset({x: 0, y: 0, z: ground})
          .setWindows(new doug.Windows(["w1", "w2", "w3", "w4"]))
        )
        .setInteriorMaterial(materials.plaster)
        .addInteriorSurface(new doug.Surface("level0")
          .setSize(roomWallSize({level: "L0", room: "cellar", side: "south"}))
          .setOffset(roomWallOffset({level: "L0", room: "cellar", sides: {x: "east", y: "south"}}, {x: southWallWidth-rooms.L0.cellar.y, y: 0, z: 0}))
        )
        .addInteriorSurface(new doug.Surface("level1")
          .setSize(roomWallSize({level: "L1", room: "living", side: "south"}))
          .setOffset(roomWallOffset({level: "L1", room: "living", sides: {x: "east", y: "south"}}, {x: southWallWidth-rooms.L1.living.y, y: 0, z: 0}))
          .setWindows(new doug.Windows(["w2"]).setJambsAll())
        )
        .addInteriorSurface(new doug.Surface("level2")
          .setSize(roomWallSize({level: "L2", room: "bedroom", side: "south"}))
          .setOffset(roomWallOffset({level: "L2", room: "bedroom", sides: {x: "east", y: "south"}}, {x: southWallWidth-rooms.L2.bedroom.y, y: 0, z: 0}))
          .setWindows(new doug.Windows(["w4"]).setJambsAll())
        )
        .setExteriorMaterial(materials.cornice)
      ;
      cornice(southWall, {dw: 0, dx: 0}, {angle:{left:-45, right:45}});
      shaper0.wallSystem(southWall);


      //West wall
      //This is by post rotation
      var lengthRightWall = 700;
      var angle = Math.atan((900-lengthRightWall)/900);//Angle of the back wall
      // console.log(Math.atan(1)*180/Math.PI);
      var lengthBackWall = Math.sqrt(Math.pow((900-lengthRightWall),2)+Math.pow(900,2));//Length of the back wall

      var extraLenR = util.extraLength([50,50,50], -angle);
      var extraLenL = util.extraLength([50,50,50], angle);
      // console.log("extralen = "+extraLenR);
      var extraLen40R = util.extraLength([40,40,40], -angle);
      var extraLen40L = util.extraLength([40,40,40], angle);


      //West Wall
      var northWallWidth = 810.5;
      var angle = 5;
      var westWallWidth = eastWallWidth/Math.cos(angle*Math.PI/180);
      var westWall = new doug.WallSystem("West Wall")
        .setPlane(new doug.Plane()
          .setFacingDirection([0,-1,0])
          .setOriginOffset([eastWallWidth, northWallWidth, 0])
          // .setRotationZ(180+angle*180/Math.PI)
          .setRotationZ(angle+180)
        )
        .setExteriorMaterial(materials.stucco)
        .addExteriorSurface(new doug.Surface("main")
          .setSize({w: westWallWidth, h: wallH})
          .setOffset({x: 0, y:0 , z: ground})
          // windows: ["window1", "window2", "window3"]
        )
      ;
      var corniceOffsetX = westWallWidth-65;
      cornice(westWall, {dw: -corniceOffsetX, dx: corniceOffsetX}, {angle:{left:0, right:45}});
      // shaper0.wallSystem(westWall);





      //North Wall.
      // var northWallWidth = 801;
      var northWall = new doug.WallSystem("North Wall")
        .setPlane(new doug.Plane().setFacingDirection([0,-1,0]).setOriginOffset([eastWallWidth,0,0]).setRotationZ(-90))
        .setExteriorMaterial(materials.stucco)
        .addExteriorSurface(new doug.Surface("main")
          .setSize({w: northWallWidth, h: wallH})
          .setOffset({x: 0, y:0 , z: ground})
          // windows: ["window1", "window2", "window3"]
        )
      //   .addExteriorSurface(new doug.Surface("pony").setProperties({
      //     size: {w: 200, h: 100},
      //     offset: {x: 700, y: 0, z: ground},//Can this be linked to previous?
      //   }))
      //   .setExteriorMaterial(materials.cornice)
      //   .addExteriorSurface(new doug.Surface("bevel1").setProperties({
      //     size: {w: lengthRightWall, h: 50},
      //     // bevel: {y: 50, miters:{in:{left:-(50+extraLenL), right:50}}},
      //     bevel: {y: 50, miters:{in:{left:-50, right:50+extraLenL}}},
      //     offset: {x: 0, y:0, z: 500}
      //   }))
      //   .addExteriorSurface(new doug.Surface("bevel2").setProperties({
      //     size: {w: lengthRightWall, h: 50},
      //     bevel: {y: 50, miters:{out:{left:-50, right:50+extraLenL}}},
      //     offset: {x: 0, y:0, z: 550}
      //   }))
      //   .addExteriorSurface(new doug.Surface("cornice band").setProperties({
      //     size: {w: lengthRightWall, h: 50},
      //     offset: {x: 0, y: 0, z: 600},//Can this be linked to previous?
      //     Material: materials.stucco
      //   }))
      //   .addExteriorSurface(new doug.Surface("bevel3").setProperties({
      //     size: {w: lengthRightWall, h: 0},
      //     bevel: {y: 40, miters:{in:{left:-40, right:(40+extraLen40L)}}},
      //     offset: {x: 0, y:0, z: 650}
      //   }))
      //   .addExteriorSurface(new doug.Surface("cornice top").setProperties({
      //     size: {w: lengthRightWall+80+extraLen40L, h: 20},
      //     offset: {x: -40, y:40, z: 650}
      //   }))
      //   .setInteriorMaterial(materials.plaster)
      //   .addInteriorSurface(new doug.Surface("level1").setProperties({
      //     size: {w: lengthRightWall-2*wallT+8, h: level1H},
      //     offset: {x: wallT, y: -wallT, z:ground },
      //     windows: ["window1", "window2"]
      //   }))
      //   .addInteriorSurface(new doug.Surface("level2").setProperties({
      //     size: {w: lengthRightWall-2*wallT+8, h: level2H},
      //     offset: {x: wallT, y: -wallT, z:level2Y },
      //     windows: ["window3"]
      //   }))
      //   .addWindow(new bigWindow("window1").setOffset({x: 200, z: 100}))
      //   .addWindow(new smallWindow("window2").setOffset({x: 500, z: 100}))
      //   .addWindow(new bigWindow("window3").setOffset({x: 200, z:  350}))
      ;
      shaper0.wallSystem(northWall);


//###############
      //Axes
      scene.add(line([[-200,0,0],[0,0,0]],0xff8888));
      scene.add(line([[0,0,0],[1600,0,0]],0xff0000));
      scene.add(line([[1,0,0],[1,-.1,0]],0xff0000));
      scene.add(line([[2,0,0],[2,-.1,0]],0xff0000));
      scene.add(line([[3,0,0],[3,-.1,0]],0xff0000));

      scene.add(line([[-100,-100,0],[-100,0,0]],0x88ff88));
      scene.add(line([[-100,0,0],[-100,100,0]],0x00ff00));

      scene.add(line([[-100,0,-100],[-100,0,0]],0x8888ff));
      scene.add(line([[-100,0,0],[-100,0,1100]],0x0000ff));
      scene.add(line([[0,0,1],[0,-.1,1]],0x0000ff));
      scene.add(line([[0,0,2],[0,-.1,2]],0x0000ff));
      scene.add(line([[0,0,3],[0,-.1,3]],0x0000ff));

      var color = 0xfdf3c6;
      var intensity = .3;
      const ambientLight = new THREE.AmbientLight(color, intensity);
      scene.add(ambientLight);


      var light = new THREE.SpotLight(0xfdf3c6, 0.9, 10000, Math.PI/4);
      light.position.set(-1000,-1000,1400);
      light.target.position.set(10,10,600);
      // light.target.updateMatrixWorld();
      // light.castShadow = true;
      // light.shadow.bias = -0.0001;
      var light2 = new THREE.SpotLight(0xfdf3c6, 0.3, 10000, Math.PI/4);
      light2.position.set(2000,2000,1400);
      light2.target.position.set(10,900,600);
      light2.target.updateMatrixWorld();
      // light2.castShadow = true;
      // light2.shadow.bias = -0.0001;
      scene.add( light2 );
      scene.add( light );
      // const helper = new THREE.SpotLightHelper( light, 5);
      // scene.add( helper );
      // const shhelper = new THREE.CameraHelper(light.shadow.camera);
      // scene.add( shhelper );

      // view.setScene(scene);
      // view.lake();

      // function render(time) {
      //   time *= 0.001;  // convert time to seconds
      //
      //   cubes.forEach((cube, ndx) => {
      //     const speed = 1 + ndx * .1;
      //     const rot = time * speed;
      //     cube.rotation.x = rot;
      //     cube.rotation.y = rot;
      //   });
      //
      //   renderer.render(scene, camera);
      //   // requestAnimationFrame(render);
      // }
      function render(time) {
        // console.log(50/Math.tan(37.5*Math.PI/180));
        time *= 0.001;  // convert time to seconds
        const speed = .5;
        const rot = time * speed;
        // camera.position.set(0,7,0);
        var vector = new THREE.Vector3( 0, -40, 1 );
        var axis = new THREE.Vector3( 0, 0, 1 );
        var angle = rot+3.5*Math.PI/2;

        // angle = .72*Math.PI/1;//look at back corner
        // angle = .26*Math.PI/1;//Look at frnt left cornice
        // angle = -.1*Math.PI/1;//Look at frnt right cornice
        // angle = 1.0*Math.PI;//Look at frnt right cornice
        // angle = 0;
        vector.applyAxisAngle( axis, angle );
        // console.log(vector);
        // camera.position.set(vector.x,vector.y,vector.z);

        //Outside
        var dist = -1900;
        camera2([450+dist*Math.sin(angle),450+dist*Math.cos(angle),700-800*Math.sin(angle)], [750,500,500], 80);
        // camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),700-800*Math.sin(angle));//450
        // camera.lookAt(750,500,500);
        // camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),0);//450

        //inside first floor
        // var dist = 10;
        // camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),200+90*Math.sin(angle/2));//450
        // camera.lookAt(450,450,200+90*Math.sin(angle/2));
        // camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),100);//450
        // camera.lookAt(450,450,100);

        //front right corner
        // camera.position.set(900-5, 0+5,200);
        // camera.lookAt(900-35,0+35,500);
        // camera2([wallW, 0, wallH+200], [wallW, 0, wallH], 30);//Top
        // camera2([eastWallWidth+50, 0-30, eastWallWidth+20], [eastWallWidth, 0, eastWallWidth], 30);

        //front left corner
        // camera.position.set(0+5, 0+5,200);
        // camera.lookAt(0+35,0+35,500);
        // camera2([0+10, 0+10, wallH+200], [0, 0, wallH], 30);//Top
        // camera2([0-80, 0-120, 1270], [0, 0, 1060], 30);

        //back right corner
        // camera.position.set(900-5, 700-5,200);
        // camera.lookAt(900-35,700-35,500);
        // camera2([900-5, 700-5,0], [900-35,700-35,500], 30)

        //back left corner
        // camera.position.set(0+5, 900-5,200);//450
        // camera.lookAt(0+35,900-35,500);
        // camera2([0-50, 942+15, 1033+18+8+5+6+6+6+18+150], [0,942+15,1033+18+8+5+6+6+6+18], 30)

        // console.log(camera.position);
        // vector.applyAxisAngle( axis, angle );
        // camera.translateOnAxis(vector, 7);

        // renderer.render(scene, camera);
        composer.render();
        requestAnimationFrame(render);
      }
      requestAnimationFrame(render);
      // renderer.render(scene, camera);

      // var vector = new THREE.Vector3( 0, 1, 0 );
      // var axis = new THREE.Vector3( 0, 0, 1 );
      // var angle = Math.PI / 4;
      // vector.applyAxisAngle( axis, angle );
      // console.log(vector);

      function camera2(position, lookAt, fov) {
        camera.position.set(position[0], position[1], position[2]);//450
        camera.lookAt(lookAt[0], lookAt[1], lookAt[2]);
        camera.fov = fov;
      }

    }

    main();
  </script>

</body>

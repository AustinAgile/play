<!DOCTYPE html>
<meta charset="utf-8">

<body>
  <!-- <canvas id="c"></canvas> -->

  <script type="module">
    import * as THREE from '../three/build/three.module.js';
    import {EffectComposer} from '../three/examples/jsm/postprocessing/EffectComposer.js';
    import { RenderPass } from "../three/examples/jsm/postprocessing/RenderPass.js";
    import { CustomOutlinePass } from "./three/CustomOutlinePass.js";
    import { ShaderPass } from "../three/examples/jsm/postprocessing/ShaderPass.js";
    import { FXAAShader } from "../three/examples/jsm/shaders/FXAAShader.js";
    import {line} from "./three/line.js";
    import * as shit from './three/plane1.js';
    // import * as alt from './three/shape.js';
    import * as alt0 from './three/shape0.js';
    import * as utilm from './three/util.js';
    // import * as zzz from './three/view.js';
    // import * as sq from './three/square.js';
    // import * as ex from './three/extrude.js';

    import * as doug from "./three/test.js";

    // var view = new zzz.view();
    var builder = new shit.builder();
    // var shaper = new alt.shaper();
    var shaper0 = new alt0.shaper();
    var util = new utilm.util();
    util.constructor();

    // var backPlane = new alt0.shaper();
    // console.log(backPlane);
    // shaper.constructor();
    shaper0.constructor();

    function main() {
      // const canvas = document.querySelector('#c');
      // const renderer = new THREE.WebGLRenderer({canvas});
      const renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setSize(1800, 900);
      // renderer.shadowMap.enabled = true;
      // renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      // renderer.shadowMap.renderReverseSided = false;
      document.body.appendChild( renderer.domElement );

      // Set up post processing
      // Create a render target that holds a depthTexture so we can use it in the outline pass
      // See: https://threejs.org/docs/index.html#api/en/renderers/WebGLRenderTarget.depthBuffer
      const depthTexture = new THREE.DepthTexture();
      const renderTarget = new THREE.WebGLRenderTarget(
        window.innerWidth,
        window.innerHeight,
        {
          depthTexture: depthTexture,
          depthBuffer: true,
        }
      );

      const fov = 70;
      const aspect = 2;  // the canvas default
      const near = 1;
      const far = 7000;
      const camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
      camera.position.set(750,-1500,1000);
      camera.up = new THREE.Vector3(0,0,1);
      camera.lookAt(new THREE.Vector3(750,0,1000));
      // console.log(camera);


      var scene = new THREE.Scene();
      scene.background = new THREE.Color("#088a40");

      // Initial render pass.
      const composer = new EffectComposer(renderer, renderTarget);
      const pass = new RenderPass(scene, camera);
      composer.addPass(pass);

      // // Outline pass.
      // const customOutline = new CustomOutlinePass(
      //   new THREE.Vector2(window.innerWidth, window.innerHeight),
      //   scene,
      //   camera
      // );
      // composer.addPass(customOutline);
      // // Antialias pass.
      // const effectFXAA = new ShaderPass(FXAAShader);
      // effectFXAA.uniforms["resolution"].value.set(
      //   1 / window.innerWidth,
      //   1 / window.innerHeight
      // );
      // composer.addPass(effectFXAA);

      // shaper.setScene(scene);
      shaper0.setScene(scene);

      // //East windows level 0
      // var l = 172;
      // shaper.addHole([l,150], [70, 60]);//door
      // l+=70;
      // l+=210;
      // shaper.addHole([l,150], [60, 60]);//door
      // l = 703;
      // shaper.addHole([l,10], [113, 224]);//door
      // l+=113;
      // l+=210;
      // shaper.addHole([l,153], [40, 50]);//door
      // l+=40;
      // l+=195;
      // shaper.addHole([l,10], [75, 193]);//door
      //
      // //East windows level 1
      // var l = 165;
      // var w = 90;
      // shaper.addHole([l,385], [w, 190]);
      // l+=w
      // l+=165
      // shaper.addHole([l,290], [w, 285]);
      // l+=w
      // l+=186
      // shaper.addHole([l,385], [w, 190]);
      // l+=w
      // l+=186
      // shaper.addHole([l,290], [w, 285]);
      // l+=w
      // l+=165
      // shaper.addHole([l,385], [w, 190]);
      //
      // //East windows level 2
      // var l = 165;
      // var w = 90;
      // shaper.addHole([l,750], [w, 190]);
      // l+=w
      // l+=165
      // shaper.addHole([l,750], [w, 190]);
      // l+=w
      // l+=186
      // shaper.addHole([l,750], [w, 190]);
      // l+=w
      // l+=186
      // shaper.addHole([l,750], [w, 190]);
      // l+=w
      // l+=165
      // shaper.addHole([l,750], [w, 190]);
      //
      // //East wall
      // var h = 0;
      // var wallH = 1033;
      // var wallW = 1500;
      // shaper.planeX([wallW,  0, wallH],[  0,   0,   0], 0xfcd690);
      // h+=wallH;
      //
      // //East cornice
      // var corniceW = 0;
      //
      // shaper.planeX([wallW+5,  5,    0],[ -5,  -5,   h], 0xfffdf2);
      // shaper.planeX([wallW+5,  0,    8],[ -5,  -5,   h], 0xfffdf2);
      // h+=8;
      // corniceW+=5;
      //
      // shaper.planeX([1510,  5,    0],[-10, -10,   h], 0xfffdf2);
      // shaper.planeX([1510,  0,   18],[-10, -10,   h], 0xfffdf2);
      // h+=18;
      // corniceW+=5;
      //
      // // shaper.planeX([1510,  5,    5],[-10, -10,   h], 0xfffdf2, true);//bevel 1
      // shaper.trapX([[1510,  0,    0],[1510,  5,    5],[-5,  5,    5]],[-10, -10,   h], 0xfffdf2, true);//bevel 1
      // h += 5;
      // corniceW+=5;
      //
      // shaper.planeX([1520,  5,    0],[-20, -20,   h], 0xfffdf2);
      // shaper.planeX([1520,  0,    6],[-20, -20,   h], 0xfffdf2);
      // h += 6;
      // corniceW+=5;
      //
      // // shaper.planeX([1520,  8,    6],[-20, -20,   h], 0xfffdf2, true);//bevel 2
      // shaper.trapX([[1520,  0,    0],[1520,  8,    6],[-8,  8,    6]],[-20, -20,   h], 0xfffdf2, true);//bevel 2
      // h += 6;
      // // shaper.planeX([1530,  0,    6],[-15, -28,   h], 0xfffdf2);
      // shaper.planeX([1528,  0,    6],[-28, -28,   h], 0xfffdf2);
      // h += 6;
      // corniceW+=8;
      //
      // // shaper.planeX([1568, 40,    0],[-68, -68,   h], 0xfffdf2);
      // shaper.trapX([[1568, 0,    0],[1568, 40,    0],[40, 40,    0]],[-68, -68,   h], 0xfffdf2);
      // shaper0.planeX([1568,  0,   18],[-68, -68,   h], 0xff4444);
      // // shaper.trapX([[1568, 0,   0],[1568,  0,   18],[0,  0,   18]],[-68, -68,   h], 0xfffdf2);
      // h += 18;
      // corniceW+=40;
      //
      // var corniceH = h-wallH;
      // console.log(corniceW);
      // shaper.trapX([[wallW+corniceW,  0,    0],[1568,  corniceW,    0],[corniceW,  corniceW,    0]],[ -68,  -corniceW,   h], 0xfffdf2);
      // shaper.planeX([wallW,  0,    corniceH],[ 0,  0,   wallH], 0xfffdf2);
      //
      // //South Side
      // var h = 0;
      // shaper.addHole([157, 385], [90, 185]);//
      // shaper.addHole([714, 385], [90, 185]);//
      // shaper.addHole([157, 750], [90, 185]);//
      // shaper.addHole([714, 750], [90, 185]);//
      // shaper.planeY([942,  0, 1033],[  0,   0,   0], 0xfcd690);
      // h+=wallH;
      //
      // //Cornice
      // shaper.planeY([952,  5,    0],[ -5,  -5,   h], 0xfffdf2);
      // shaper.planeY([952,  0,    8],[ -5,  -5,   h], 0xfffdf2);
      // h+=8;
      //
      // shaper.planeY([962,  5,    0],[-10, -10,   h], 0xfffdf2);
      // shaper.planeY([962,  0,   18],[-10, -10,   h], 0xfffdf2);
      // h+=18;
      //
      // // shaper.planeY([962,  5,    5],[-10, -10,   h], 0xfffdf2, true);//bevel 1
      // shaper.trapY([[962,0,0],[967,5,5],[-5,5,5]],[-10, -10,   h], 0xfffdf2, true);//bevel 1
      // h += 5;
      //
      // shaper.planeY([982,  5,    0],[-20, -20,   h], 0xfffdf2);
      // shaper.planeY([982,  0,    6],[-20, -20,   h], 0xfffdf2);
      // h += 6;
      //
      // // shaper.planeY([982,  8,    6],[-20, -20,   h], 0xffff00, true);//bevel 2
      // shaper.trapY([[982,  0,    0],[990,  8,    6],[-8,  8,    6]],[-20, -20,   h], 0xfffdf2, true);//bevel 2????
      // h += 6;
      // shaper.planeY([998,  0,    6],[-28, -28,   h], 0xfffdf2);
      // h+=6;
      //
      // // shaper.planeY([1078, 40,    0],[-68, -68,   h], 0xff0000);
      // shaper.trapY([[1078, 0,    0],[1038, 40,    0],[40, 40,    0]],[-68, -68,   h], 0xfffdf2);//????
      // shaper.planeY([1078,  0,   18],[-68, -68,   h], 0xfffdf2);
      // h+=18;
      //
      // console.log(corniceW);
      // shaper.trapY([[1078,  0,    0],[1078-corniceW,  corniceW,    0],[corniceW,  corniceW,  0]],[ -68,  -corniceW,   h], 0xfffdf2);
      // shaper.planeY([942,  0,    corniceH],[ 0,  0,   wallH], 0xfffdf2);
      //
      // //South Side Kitchen
      // var h = 0;
      // shaper.addHole([70, 400], [30, 30]);//door
      // shaper.addHole([293, 385], [90, 135]);//door
      // shaper.planeY([393,  0, 630],[  0,   942,   0], 0xfcd690);
      // h+=wallH;
      //
      // //West Side
      // shaper.addHole([133, 5], [110, 214]);//door
      // shaper.planeX([900,  0, 340],[  600,   942,   290], 0xfcd690);//Lower wall
      //
      // shaper.addHole([733, 100], [90, 125]);//door
      // shaper.planeX([1500,  0, 403],[  0,   942,   630], 0xfcd690);//Upper wall
      //
      // shaper.planeX([1440,  0, corniceH],[  60,   942,   wallH], 0xfcd690);//Top wall// attempt to rotate this wall a bit more
      //
      // //West Cornice
      // shaper.planeX([65,  5,    0],[ -5,  942,   h], 0xfffdf2);
      // shaper.planeX([65,  0,    8],[ -5,  947,   h], 0xfffdf2);
      // h+=8;
      // shaper.planeX([70,  5,    0],[-10, 947,   h], 0xfffdf2);
      // shaper.planeX([70,  0,   18],[-10, 952,   h], 0xfffdf2);
      // h+=18;
      // // shaper.planeX([70,  5,    5],[-10, 952,   h], 0xfffdf2, false);//bevel 1
      // shaper.trapX([[70,  0,    0],[70,  5,    5],[-5,  5,    5]],[-10, 952,   h], 0xfffdf2, false);//bevel 1
      // h += 5;
      //
      // shaper.planeX([80,  5,    0],[-20, 957,   h], 0xfffdf2);
      // shaper.planeX([80,  0,    6],[-20, 962,   h], 0xfffdf2);
      // h += 6;
      //
      // // shaper.planeX([80,  8,    6],[-20, 962,   h], 0xfffdf2, false);//bevel 2
      // shaper.trapX([[80,  0,    0],[80,  8,    6],[-8,  8,    6]],[-20, 962,   h], 0xfffdf2, false);//bevel 2
      // h += 6;
      // shaper.planeX([88,  0,    6],[-28, 970,   h], 0xfffdf2);
      // h+=6;
      //
      // // shaper.planeX([128, 40,    0],[-68, 970,   h], 0xff0000);
      // shaper.trapX([[88, 0,    0],[88, 40,    0],[-40, 40,    0]],[-28, 970,   h], 0xfffdf2);
      // shaper.planeX([128,  0,   18],[-68, 1010,   h], 0xfffdf2);
      // h+=18;
      //
      // shaper.trapX([[60,  0,    0],[60,  corniceW,    0],[-68,  corniceW,    0]],[ 0,  942,   h], 0xfffdf2);
      // shaper.planeX([60,  0,    corniceH],[ 0,  942,   wallH], 0xfffdf2);

      // shaper0.addHole([200, 100], [200, 100]);//door
      // shaper0.main2([[900,0,0],[900,500,0],[0,500,0]],[ 0, 0, 0], [ 90, 0, 0], 0xfffdf2);

      var colors = {
        stucco: {f: 0xfcd690, b:0xff0000},
        cornice: {f: 0xfffdf2, b:0xff0000},
        plaster: {f: 0xa3a3a3, b:0xffff00},
        floor: {f: 0xb58148, b:0x5555ff},
        debug: {f: 0xff0000, b:0x0000ff}
      };

      var ground = 0;
      var level1Y = ground;
      var level1H = 300;
      var level1CeilingThickness = 20;
      var level2Y = level1H+level1CeilingThickness;
      var level2H = 350;
      var totalH = level1Y+level1H+level1CeilingThickness+level2H;
      var wallT = 40;

      class bigWindow extends doug.Window {size = {w: 200, h: 100};};
      class smallWindow extends doug.Window {size = {w: 100, h: 50};};

      //Front Wall
      var wallFront = new doug.WallSystem("Front Wall")
        .setPlane(new doug.Plane()
          .setFacingDirection([0,-1,0])
          .setOriginOffset([0,0,0])
          .setRotationZ(0)
        )
        .setExteriorColor(colors.stucco)
        .addExteriorSurface(new doug.Surface("main").setProperties({
          size: {w: 900, h: 500},
          offset: {x: 0, y: 0, z: ground},
          windows: ["window1", "window2", "window3"]
        }))
        .addExteriorSurface(new doug.Surface("pony").setProperties({
          size: {w: 200, h: 100},
          offset: {x: 900, y:0, z: ground},
        }))
        .addExteriorSurface(new doug.Surface("cornice band").setProperties({
          size: {w: 900, h: 50},
          offset: {x: 0, y: 0, z: 600},
        }))
        .setInteriorColor(colors.plaster)
        .addInteriorSurface(new doug.Surface("level1").setProperties({
          size: {w: 900-2*wallT, h: level1H},
          offset: {x: wallT, y: -wallT, z: ground},
          windows: ["window1", "window2"]
        }))
        .addInteriorSurface(new doug.Surface("level2").setProperties({
          size: {w: 900-2*wallT, h: level2H},
          offset: {x: wallT, y: -wallT, z:level2Y },
          windows: ["window3"]
        }))
        .addWindow(new bigWindow("window1").setOffset({x: 200, z: 100}))
        .addWindow(new smallWindow("window2").setOffset({x: 500, z: 100}))
        .addWindow(new bigWindow("window3").setOffset({x: 200, z:  350}))
      ;
      shaper0.wallSystem(wallFront);

      //These are the bevel decorations
      shaper0.bevelWall([[900,0,0],[950,50,50],[-50,50,50]],[ 0, 0, 500], [ 0, 0, 0], colors.cornice);
      shaper0.bevelWall([[1000,0,-50],[950,50,-50],[50,50,0]],[ -50, 50, 550], [ 0, 0, 0], colors.cornice);
      shaper0.bevelWall([[900,0,0],[940,40,0],[-40,40,0]],[ 0, 0, 650], [ 90, 0, 0], colors.cornice);
      shaper0.planeWall([980,20],[ -40, 40, 650], [ 0, 0, 0], colors.cornice);

      //floor
//      shaper0.bevelWall([[900-2*wallT,0,0],[900-2*wallT,700-2*wallT+10,0],[0,900-2*wallT-10,0]],[ wallT, -wallT, level1Y], [ -90, 0, 0], colors.floor);
//      shaper0.bevelWall([[900-2*wallT,0,0],[900-2*wallT,700-2*wallT+10,0],[0,900-2*wallT-10,0]],[ wallT, -wallT, level1H], [ -90, 0, 0], colors.plaster, true);
//      shaper0.bevelWall([[900-2*wallT,0,0],[900-2*wallT,700-2*wallT+10,0],[0,900-2*wallT-10,0]],[ wallT, -wallT, level2Y], [ -90, 0, 0], colors.floor);

      //Back Wall
      // shaper0.addHole([200, 100], [200, 100]);//door
      // shaper0.addHole([500, 100], [100, 50]);//door
      // shaper0.setPlane([0,1,0],[900,900,0], 30);
      // // shaper0.setPlane([0,1,0],[1100,0,0]);
      // shaper0.bevelWall([[900,0,0],[900,500,0],[0,500,0]],[ 0, 0, 0], [ 0, 0, 0], 0xfffdf2);
      // shaper0.bevelWall([[200,0,0],[200,100,0],[0,100,0]],[ 900, 0, 0], [ 0, 0, 0], 0xfffdf2);
      // // // shaper0.bevelWall([[900,0,0],[1000,50,0],[-100,50,0]],[ 0, 0, 500], [ 0, 0, 0], 0x0000ff);
      // // // shaper0.bevelWall([[1100,0,0],[1000,50,0],[100,50,0]],[ -100, 0, 555], [ 0, 0, 0], 0xff0000);
      // shaper0.bevelWall([[900,0,0],[950,50,50],[-50,50,50]],[ 0, 0, 500], [ 0, 0, 0], 0xfffdf2);
      // shaper0.bevelWall([[1000,0,0],[950,50,-50],[50,50,-50]],[ -50, 50, 550], [ 0, 0, 0], 0xfffdf2);


      //BACK wall
      //This is by post rotation
      var RightLen = 700;
      var angle = Math.atan((900-RightLen)/900);//Angle of the back wall
      // console.log(Math.atan(1)*180/Math.PI);
      var length = Math.sqrt(Math.pow((900-RightLen),2)+Math.pow(900,2));//Length of the back wall
      var a2 = angle/2 + Math.PI/4;//angle between per walls
      var xtraLen = 50*(Math.tan(a2)-1);//extra length added to cornice
      var xtraLen2 = 40*(Math.tan(a2)-1);//extra length added to cornice
      // console.log(angle*180/Math.PI);
      // console.log(length);
      // console.log(a2*180/Math.PI);
      // console.log(xtraLen);
      // var vec = new THREE.Vector3(50,50,50);
      // console.log(vec.getComponent(0));
      // console.log(vec.getComponent(1));
      // console.log(vec.getComponent(2));
      // var axis = new THREE.Vector3(0,0,1);
      // vec.applyAxisAngle( axis, angle );
      // console.log(vec.getComponent(0));
      // console.log(vec.getComponent(1));
      // console.log(vec.getComponent(2));
      // var dist = Math.sqrt(Math.pow(50 - vec.getComponent(0), 2)+Math.pow(50-vec.getComponent(1),2))/2;
      // console.log("dist="+dist);
      // var a2 = Math.PI/4 - angle/1
      // // a2=20*Math.PI/180;
      // console.log("a1="+angle*180/Math.PI);
      // console.log("a2="+a2*180/Math.PI);
      // var a2sin = Math.sin(a2);
      // console.log(a2sin);
      // var extraLen = dist/a2sin;
      // console.log("new len = "+extraLen);
      // console.log("old len = "+xtraLen);
      var extraLenR = util.extraLength([50,50,50], -angle);
      var extraLenL = util.extraLength([50,50,50], angle);
      // console.log("extralen = "+extraLenR);
      xtraLen = extraLenR;
      var extraLen40R = util.extraLength([40,40,40], -angle);
      var extraLen40L = util.extraLength([40,40,40], angle);


      //Back Wall
      var wallBack = new doug.WallSystem("Back Wall")
        .setPlane(new doug.Plane()
          .setFacingDirection([0,-1,0])
          .setOriginOffset([900, RightLen, 0])
          .setRotationZ(180+angle*180/Math.PI)
        )
        .setExteriorColor(colors.stucco)
        .addExteriorSurface(new doug.Surface("main").setProperties({
          size: {w: length, h: 500},
          offset: {x: 0, y:0 , z: ground},
          windows: ["window1", "window2", "window3"]
        }))
        .addExteriorSurface(new doug.Surface("pony").setProperties({
          size: {w: 200, h: 100},
          offset: {x: 900, y: 0, z: ground},
        }))
        .addExteriorSurface(new doug.Surface("cornice band").setProperties({
          size: {w: length, h: 50},
          offset: {x: 0, y: 0, z: 600},
        }))
        .setInteriorColor(colors.plaster)
        // shaper0.bevelWall([[length-2*wallT,0,0],[length-2*wallT,level1H,0],[0,level1H,0]],[ wallT-10, -wallT, level1Y], [ 0, 0, 0], colors.plaster, true);
        .addInteriorSurface(new doug.Surface("level1").setProperties({
          size: {w: length-2*wallT, h: level1H},
          offset: {x: wallT-10, y: -wallT , z:level1Y },
          windows: ["window1", "window2"]
        }))
        // shaper0.bevelWall([[length-2*wallT,0,0],[length-2*wallT,level2H,0],[0,level2H,0]],[ wallT-10, -wallT, level2Y], [ 0, 0, 0], colors.plaster, true);
        .addInteriorSurface(new doug.Surface("level2").setProperties({
          size: {w: 900-2*wallT, h: level2H},
          offset: {x: wallT-10, y: -wallT , z:level2Y},
          windows: ["window3"]
        }))
        .addWindow(new bigWindow("window1").setOffset({x: 200, z: 100}))
        .addWindow(new smallWindow("window2").setOffset({x: 500, z: 100}))
        .addWindow(new bigWindow("window3").setOffset({x: 200, z:  350}))
      ;
      shaper0.wallSystem(wallBack);

      // shaper0.addHole([200, 100], [200, 100]);//door
      // shaper0.addHole([500, 100], [100, 50]);//door
//      shaper0.setPlane([0,-1,0],[900,RightLen,0], 180+angle*180/Math.PI);
      // shaper0.bevelWall([[length,0,0],[length,500,0],[0,500,0]],[ 0, 0, 0], [ 0, 0, 0], colors.stucco);
//      shaper0.bevelWall([[length,0,0],[length,500,0],[0,500,0]],[ 0, 0, 0], [ 0, 0, 0], colors.stucco);
//      shaper0.bevelWall([[200,0,0],[200,100,0],[0,100,0]],[ length, 0, 0], [ 0, 0, 0], colors.stucco);
      shaper0.bevelWall([[length,0,0],[length+50+extraLenR,50,50],[-(50+extraLenL),50,50]],[ 0, 0, 500], [ 0, 0, 0], colors.cornice);
      shaper0.bevelWall([[length+100+extraLenL+extraLenR,0,0],[length+50+extraLenL,50,-50],[50+extraLenL,50,-50]],[ -(50+extraLenL), 50, 550], [ 0, 0, 0], colors.cornice);
      // shaper0.bevelWall([[length,0,0],[length,50,0],[0,50,0]],[ 0, 0, 600], [ 0, 0, 0], colors.stucco);
      shaper0.bevelWall([[length,0,0],[length+40+extraLen40R,40,0],[-(40+extraLen40L),40,0]],[ 0, 0, 650], [ 90, 0, 0], colors.cornice);
      shaper0.bevelWall([[length+80+extraLen40L+extraLen40R,0,0],[length+80+extraLen40L+extraLen40R,20,0],[0,20,0]],[ -(40+extraLen40L), 40, 650], [ 0, 0, 0], colors.cornice);
      //test square
      // shaper0.bevelWall([[60,0,0],[60,50,0],[50-12,50,0]],[ -50+12, 50, 551], [ -90, 0, 0], 0xffff00);

      // shaper0.window([200, 100], [200, 100], 40, colors.plaster);
      // shaper0.window([500, 100], [100, 50], 40, colors.plaster);

      // shaper0.addHole([200-40+10, 100], [200, 100]);//door
      // shaper0.addHole([500-40+10, 100], [100, 50]);//door
      // shaper0.bevelWall([[length-40-40,0,0],[length-40-40,totalH,0],[0,totalH,0]],[ 40-10, -40, 0], [ 0, 0, 0], colors.plaster, true);
      // shaper0.addHole([200-wallT+10, 100], [200, 100]);//door
      // shaper0.addHole([500-wallT+10, 100], [100, 50]);//door
//      shaper0.bevelWall([[length-2*wallT,0,0],[length-2*wallT,level1H,0],[0,level1H,0]],[ wallT-10, -wallT, level1Y], [ 0, 0, 0], colors.plaster, true);
//      shaper0.bevelWall([[length-2*wallT,0,0],[length-2*wallT,level2H,0],[0,level2H,0]],[ wallT-10, -wallT, level2Y], [ 0, 0, 0], colors.plaster, true);

      //Left Wall. This is the old way, without plane rotation.
      // shaper0.addHole([200, 100], [200, 100]);//door
      // shaper0.addHole([500, 100], [100, 50]);//door
      // shaper0.setPlane([-1,0,0],[0,900,0], 0);
      // shaper0.bevelWall([[900,0,0],[900,500,0],[0,500,0]],[ 0, 0, 0], [ 0, 0, 0], 0xfffdf2);
      // shaper0.bevelWall([[200,0,0],[200,100,0],[0,100,0]],[ 900, 0, 0], [ 0, 0, 0], 0xfffdf2);
      // // // // shaper0.bevelWall([[900,0,0],[1000,50,0],[-100,50,0]],[ 0, 0, 500], [ 0, 0, 0], 0x0000ff);
      // // // // shaper0.bevelWall([[1100,0,0],[1000,50,0],[100,50,0]],[ 0, -100, 555], [ 0, 0, 0], 0xff0000);
      // shaper0.bevelWall([[900,0,0],[950,50,50],[-50,50,50]],[ 0, 0, 500], [ 0, 0, 0], 0x0000ff);
      // shaper0.bevelWall([[1000,0,0],[950,50,-50],[50,50,-50]],[ -50, 50, 550], [ 0, 0, 0], 0xff0000);

      //Left Wall
      var wallLeft = new doug.WallSystem("Left Wall")
        .setPlane(new doug.Plane().setFacingDirection([0,-1,0]).setOriginOffset([0,900,0]).setRotationZ(90))
        .setExteriorColor(colors.stucco)
        .addExteriorSurface(new doug.Surface("main").setProperties({
          size: {w: 900, h: 500},
          offset: {x: 0, y: 0, z: ground},
          windows: ["window1", "window2", "window3"]
        }))
        .addExteriorSurface(new doug.Surface("pony").setProperties({
          size: {w: 200, h: 100},
          offset: {x: 900, y: 0, z: ground},
        }))
        .addExteriorSurface(new doug.Surface("cornice band").setProperties({
          size: {w: 900, h: 50},
          offset: {x: 0, y: 0, z: 600},
        }))
        .setInteriorColor(colors.plaster)
        .addInteriorSurface(new doug.Surface("level1").setProperties({
          size: {w: 900-2*wallT+10, h: level1H},
          offset: {x: wallT+10, y: -wallT, z:ground },
          windows: ["window1", "window2"]
        }))
        .addInteriorSurface(new doug.Surface("level2").setProperties({
          size: {w: 900-2*wallT+10, h: level2H},
          offset: {x: wallT+10, y: -wallT, z:level2Y},
          windows: ["window3"]
        }))
        .addWindow(new bigWindow("window1").setOffset({x: 200, z: 100}))
        .addWindow(new smallWindow("window2").setOffset({x: 500, z: 100}))
        .addWindow(new bigWindow("window3").setOffset({x: 200, z:  350}))
      ;
      shaper0.wallSystem(wallLeft);

      shaper0.bevelWall([[900,0,0],[950,50,50],[-(50+extraLenR),50,50]],[ 0, 0, 500], [ 0, 0, 0], colors.cornice);
      shaper0.bevelWall([[1000+extraLenR,0,0],[950+extraLenR,50,-50],[50+extraLenR,50,-50]],[ -(50+extraLenR), 50, 550], [ 0, 0, 0], colors.cornice);
      shaper0.bevelWall([[900,0,0],[940,40,0],[-(40+extraLen40R),40,0]],[ 0, 0, 650], [ 90, 0, 0], colors.cornice);
      shaper0.bevelWall([[980+extraLen40R,0,0],[980+extraLen40R,20,0],[0,20,0]],[ -(40+extraLen40R), 40, 650], [ 0, 0, 0], colors.cornice);

      //Right Wall.
      var RightLen = 700;
      var wallRight = new doug.WallSystem("Right Wall")
        .setPlane(new doug.Plane().setFacingDirection([0,-1,0]).setOriginOffset([900,0,0]).setRotationZ(-90))
        .setExteriorColor(colors.stucco)
        .addExteriorSurface(new doug.Surface("main").setProperties({
          size: {w: RightLen, h: 500},
          offset: {x: 0, y:0 , z: ground},
          windows: ["window1", "window2", "window3"]
        }))
        .addExteriorSurface(new doug.Surface("pony").setProperties({
          size: {w: 200, h: 100},
          offset: {x: 700, y: 0, z: ground},//Can this be linked to previous?
        }))
        .addExteriorSurface(new doug.Surface("cornice band").setProperties({
          size: {w: RightLen, h: 50},
          offset: {x: 0, y: 0, z: 600},//Can this be linked to previous?
        }))
        .setInteriorColor(colors.plaster)
        .addInteriorSurface(new doug.Surface("level1").setProperties({
          size: {w: RightLen-2*wallT+10, h: level1H},
          offset: {x: wallT, y: -wallT, z:ground },
          windows: ["window1", "window2"]
        }))
        .addInteriorSurface(new doug.Surface("level2").setProperties({
          size: {w: RightLen-2*wallT+10, h: level2H},
          offset: {x: wallT, y: -wallT, z:level2Y },
          windows: ["window3"]
        }))
        .addWindow(new bigWindow("window1").setOffset({x: 200, z: 100}))
        .addWindow(new smallWindow("window2").setOffset({x: 500, z: 100}))
        .addWindow(new bigWindow("window3").setOffset({x: 200, z:  350}))
      ;
      shaper0.wallSystem(wallRight);

      shaper0.bevelWall([[RightLen,0,0],[RightLen+50+extraLenL,50,50],[-50,50,50]],[ 0, 0, 500], [ 0, 0, 0], colors.cornice);
      shaper0.bevelWall([[RightLen+100+extraLenL,0,0],[RightLen+50,50,-50],[50,50,-50]],[ -50, 50, 550], [ 0, 0, 0], colors.cornice);
      shaper0.bevelWall([[RightLen,0,0],[RightLen+40+extraLen40L,40,0],[-40,40,0]],[ 0, 0, 650], [ 90, 0, 0], colors.cornice);
      shaper0.bevelWall([[RightLen+80+extraLen40L,0,0],[RightLen+80+extraLen40L,20,0],[0,20,0]],[ -40, 40, 650], [ 0, 0, 0], colors.cornice);


//###############
      //Axes
      scene.add(line([[-200,0,0],[0,0,0]],0xff8888));
      scene.add(line([[0,0,0],[1600,0,0]],0xff0000));
      scene.add(line([[1,0,0],[1,-.1,0]],0xff0000));
      scene.add(line([[2,0,0],[2,-.1,0]],0xff0000));
      scene.add(line([[3,0,0],[3,-.1,0]],0xff0000));

      scene.add(line([[-100,-100,0],[-100,0,0]],0x88ff88));
      scene.add(line([[-100,0,0],[-100,100,0]],0x00ff00));

      scene.add(line([[-100,0,-100],[-100,0,0]],0x8888ff));
      scene.add(line([[-100,0,0],[-100,0,1100]],0x0000ff));
      scene.add(line([[0,0,1],[0,-.1,1]],0x0000ff));
      scene.add(line([[0,0,2],[0,-.1,2]],0x0000ff));
      scene.add(line([[0,0,3],[0,-.1,3]],0x0000ff));

      var color = 0xfdf3c6;
      var intensity = .3;
      const ambientLight = new THREE.AmbientLight(color, intensity);
      scene.add(ambientLight);


      var light = new THREE.SpotLight(0xfdf3c6, 0.9, 10000, Math.PI/4);
      light.position.set(-1000,-1000,1400);
      light.target.position.set(10,10,600);
      // light.target.updateMatrixWorld();
      // light.castShadow = true;
      // light.shadow.bias = -0.0001;
      var light2 = new THREE.SpotLight(0xfdf3c6, 0.3, 10000, Math.PI/4);
      light2.position.set(2000,2000,1400);
      light2.target.position.set(10,900,600);
      light2.target.updateMatrixWorld();
      // light2.castShadow = true;
      // light2.shadow.bias = -0.0001;
      scene.add( light2 );
      scene.add( light );
      // const helper = new THREE.SpotLightHelper( light, 5);
      // scene.add( helper );
      // const shhelper = new THREE.CameraHelper(light.shadow.camera);
      // scene.add( shhelper );

      // view.setScene(scene);
      // view.lake();

      // function render(time) {
      //   time *= 0.001;  // convert time to seconds
      //
      //   cubes.forEach((cube, ndx) => {
      //     const speed = 1 + ndx * .1;
      //     const rot = time * speed;
      //     cube.rotation.x = rot;
      //     cube.rotation.y = rot;
      //   });
      //
      //   renderer.render(scene, camera);
      //   // requestAnimationFrame(render);
      // }
      function render(time) {
        // console.log(50/Math.tan(37.5*Math.PI/180));
        time *= 0.001;  // convert time to seconds
        const speed = .5;
        const rot = time * speed;
        // camera.position.set(0,7,0);
        var vector = new THREE.Vector3( 0, -40, 1 );
        var axis = new THREE.Vector3( 0, 0, 1 );
        var angle = rot+3.5*Math.PI/2;

        // angle = .72*Math.PI/1;//look at back corner
        // angle = .26*Math.PI/1;//Look at frnt left cornice
        // angle = -.1*Math.PI/1;//Look at frnt right cornice
        // angle = 1.0*Math.PI;//Look at frnt right cornice
        // angle = 0;
        vector.applyAxisAngle( axis, angle );
        // console.log(vector);
        // camera.position.set(vector.x,vector.y,vector.z);

        //Outside
        var dist = -2200;
        camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),700-800*Math.sin(angle));//450
        camera.lookAt(450,450,500);
        // camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),0);//450

        //inside first floor
        // var dist = 10;
        // camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),200+90*Math.sin(angle/2));//450
        // camera.lookAt(450,450,200+90*Math.sin(angle/2));
        // camera.position.set(450+dist*Math.sin(angle),450+dist*Math.cos(angle),100);//450
        // camera.lookAt(450,450,100);

        //front right corner
        // camera.position.set(900, 0,1500);
        // camera.lookAt(900,0,500);

        //front left corner
        // camera.position.set(0, 0,1500);
        // camera.lookAt(0,0,500);

        //back right corner
        // camera.position.set(900, 700,1500);
        // camera.lookAt(900,700,500);

        //back left corner
        // camera.position.set(0, 900,1500);//450
        // camera.lookAt(0,900,500);

        // console.log(camera.position);
        // vector.applyAxisAngle( axis, angle );
        // camera.translateOnAxis(vector, 7);

        // renderer.render(scene, camera);
        composer.render();
        requestAnimationFrame(render);
      }
      requestAnimationFrame(render);
      // renderer.render(scene, camera);

      // var vector = new THREE.Vector3( 0, 1, 0 );
      // var axis = new THREE.Vector3( 0, 0, 1 );
      // var angle = Math.PI / 4;
      // vector.applyAxisAngle( axis, angle );
      // console.log(vector);

    }

    main();
  </script>

</body>

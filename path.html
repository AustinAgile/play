<!DOCTYPE html>
<html>
<head>
<title>D3.js - A Simple Path Animation</title>

<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

<!-- using jquery library for browser compatibility -->
<script type="text/javascript" src="js/jquery.min.js"></script>

<!-- load underscore library for javascript utilities -->
<script type="text/javascript" src="js/underscore.js"></script>

<!-- load d3 library d3js.org for vector rendering -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<script type="text/javascript" src="js/highlight.min.js"></script>
<link rel="stylesheet" href="css/github.css" />
<style>

.path {
  fill: none;
  stroke: #ffaaaa;
  stroke-width: 3px;
  /*stroke-dasharray: 6; */
  }

.animated-object {
  fill: #ff0000;
  }

</style>

<script type="text/javascript">

jQuery.noConflict();
jQuery(document).ready(function($){

	var _app = {
		'paper': null,
		'width': '760',
		'height': '500',
    'path': null
	};

	// render the svg
	_app.paper = d3.select('#paper')
		.append('svg')
		.attr("width", _app.width)
		.attr("height", _app.height)
			.append("g")
    	.attr("transform", "translate(64,64)");
console.log(_app.paper);
	// render the app
	render();


	function render(){
		// _app.path = _app.paper
    //   .attr('class', 'path')
		// 	.append('path')
    //   /*
    //   .attr('d', 'M48.101,68.33C90,35.369,99.318,115.644,144.749,144.866c111.173,71.508,135.754-64.246,218.995-93.854c37.619-13.381,2.299,91.346,122.347,101.117c48.044,3.911-56.983,189.944-108.939,168.157c-0.477-0.2-179.988-62.742-180.446-62.57c-53.631-22.346-154.291,107.759-49.721,99.441C196.146,353.246-18.784,120.945,48.101,68.33z');
    //   */
		// 	.attr('d', 'M48.101,68.33c2.804-2.692,51.217,47.314,96.648,76.536c111.173,71.508,135.754-64.246,218.995-93.854c37.619-13.381,2.299,91.346,122.347,101.117c48.044,3.911-56.983,189.944-108.939,168.157c-0.477-0.2-179.988-62.742-180.446-62.57c-53.631-22.346-154.291,107.759-49.721,99.441c49.162-3.91-118.436-149.721-112.849-234.637');


    var points = [
      [280, 100],
      [380, 300],
      [480, 0],
      [580, 200],
      [0, 200],
      [80, 0],
      [50, 480],
      [150, 320]
    ];
      _app.path = _app.paper
        .append("path")
          .attr('class', 'path')
          .data([points])
          .attr("d", d3.line()
          .curve(d3.curveBasis) // Catmullâ€“Rom
      );

      var sugar = _app.paper.append("g")
        .attr("transform", "translate("+[280-50/2, 100-150]+")")
        .append("rect")
          .attr("id", "sugar")
          .attr("width", 50)
          .attr("height", 150)
          .style("stroke", "red")
          .style("fill", "red")
          ;
      //  console.log(sugar.attr("height"));
      var atp = _app.paper.append("g")
        .attr("transform", "translate("+[150-2, 320-75]+")")
        .append("rect")
          .attr("id", "atp")
          .attr("width", 100)
          .attr("height", 5)
          .attr("transform", function() {return "translate(0 "+(75-d3.select(this).attr("height")+1.6)+")";})
          .style("stroke", "red")
          .style("fill", "red")
          ;

      var stomach = _app.paper.append("g")
        .attr("transform", "translate("+[0, 0]+") scale(.5)")
        .append("path")
          .attr("d", "M67.031,1.737h20.782c0,0-2.557,50.606,18.706,36.37c9.73-6.503,26.372-18.058,46.765-0.518    c16.033,13.786,30.307,36.419,8.312,84.171c-11.473,24.898-49.566,64.222-107.559,21.306    c-8.823-6.528-32.212-22.341-33.771,28.059H0.001c0,0-0.792-58.961,33.253-54.559c17.646,2.283,58.419,13.055,64.953-29.101    c1.352-8.723,5.158-19.491-15.588-31.693C73.784,50.578,66.507,45.901,67.031,1.737z")
          .style("stroke", "red")
          .style("fill", "none")
          ;
        var kidney = _app.paper.append("g")
          .attr("transform", "translate("+[100, 0]+") scale(.5)")
          .append("path")
            .attr("d", "M125.699,5.978c-14.63-12.186-24.597-2.889-29.202,2.818c-6.01,7.442-3.151,18.017,0.332,22.386    c2.222,2.78,3.734,5.218,4.739,7.398c-2.059,0.402-4.441,1.278-6.949,3.059c-9.057,6.438-15.289,21.024-18.641,43.566    c-3.356-22.542-9.581-37.128-18.637-43.566c-2.509-1.789-4.884-2.662-6.952-3.064c1.006-2.181,2.509-4.613,4.739-7.393    c3.479-4.369,6.344-14.944,0.336-22.386C50.854,3.089,40.89-6.208,26.259,5.978C14.089,16.121-3.864,46.462,13.116,68.02    c5.591,7.095,19.577,16.692,36.081,1.428c0,0,8.667-9.513,2.059-17.831c-1.23-1.551-2.178-3.374-2.418-5.589    c1.232,0.221,2.706,0.7,4.414,1.981c5.02,3.762,12.136,14.223,15.761,42.536c-8.208,2.02-14.131,7.453-14.131,13.894    c0,6.981,6.938,12.811,16.227,14.358c0.276,8.722,0.332,18.348,0.036,29.28l-0.101,3.875h9.848l-0.101-3.875    c-0.295-10.922-0.239-20.559,0.035-29.28c9.278-1.537,16.222-7.365,16.222-14.358c0-6.44-5.92-11.874-14.126-13.894    c3.626-28.313,10.756-38.769,15.762-42.536c1.719-1.281,3.196-1.771,4.416-1.989c-0.238,2.224-1.176,4.052-2.418,5.604    c-6.608,8.312,2.058,17.83,2.058,17.83c16.506,15.264,30.49,5.667,36.084-1.428C155.823,46.462,137.87,16.121,125.699,5.978z")
            .style("stroke", "red")
            .style("fill", "none")
            ;
        var mitochondria = _app.paper.append("g")
        mitochondria.append("path")
          .attr("d", "M47.889,248.577c-5.798,0 -10.506,4.708 -10.506,10.506l0,24.43c0,5.799 4.708,10.507 10.506,10.507c5.799,0 10.506,-4.708 10.506,-10.507c0,0 0,-24.43 0,-24.43c0,-5.798 -4.707,-10.506 -10.506,-10.506Zm0,1.671c-4.876,0 -8.835,3.959 -8.835,8.835l0,24.43c0,4.877 3.959,8.836 8.835,8.836c4.876,0 8.835,-3.959 8.835,-8.836l0,-24.43c0,-4.876 -3.959,-8.835 -8.835,-8.835Z")
//          .attr("transform-origin", "-175 250")
          .attr("transform", "translate("+[175, -250]+") scale(1)")
          .style("stroke", "#731e27")
          .style("fill", "#dfbd7d")
          ;
        mitochondria.append("path")
          .attr("transform", "translate("+[175, -250]+") scale(1)")
          .attr("d", "M40.278,283.513c0.142,0.939 0.297,1.82 0.516,2.628c0.115,0.42 4.58,-1.338 4.737,-0.96c0.143,0.344 -4.028,2.826 -3.838,3.132c1.018,1.642 2.795,2.72 6.196,2.981c3.76,0.29 5.739,-0.917 6.76,-2.659c0.149,-0.255 -4.587,-2.461 -4.476,-2.737c0.114,-0.283 5.075,1.364 5.153,1.066c0.22,-0.831 0.314,-1.706 0.342,-2.554c0.006,-0.186 0.013,-0.376 0.02,-0.57c0.012,-0.338 -5.023,-0.84 -5.009,-1.2c0.016,-0.394 5.081,-0.648 5.099,-1.066c0.024,-0.573 0.05,-1.167 0.077,-1.777c0.01,-0.234 -8.35,-1.789 -8.34,-2.028c0.015,-0.348 8.709,1.655 8.404,0.663c-0.3,-0.974 0.07,-1.755 0.098,-2.448c0.011,-0.26 -5.275,-1.497 -5.53,-1.562c-2.065,-0.531 3.758,-0.21 5.614,-0.616c0.509,-0.112 -0.057,-1.055 0.054,-1.566c0.186,-0.86 -5.136,-1.102 -5.517,-1.491c-0.739,-0.753 5.56,-0.578 5.566,-0.235c0.013,0.788 0.018,-1.571 0.047,-2.342c0.063,-1.647 -4.24,-1.094 -4.237,-1.455c0.004,-0.567 4.238,0.053 4.252,-1.311c0.007,-0.656 -0.011,-1.296 -0.026,-1.914c-0.031,-1.297 -11.29,-1.08 -11.305,-1.585c-0.017,-0.533 11.026,0.111 11.205,-1.516c0.118,-1.072 -0.147,-2.027 -0.267,-2.808c-0.064,-0.411 -0.193,-0.819 -0.377,-1.218c-0.142,-0.307 -5.212,1.356 -5.412,1.062c-0.281,-0.413 4.283,-2.773 3.913,-3.146c-1.786,-1.804 -4.419,-3.052 -6.108,-2.89c-0.702,0.067 -1.589,0.252 -2.508,0.596c-0.274,0.102 1.53,4.924 1.254,5.056c-0.464,0.221 -3.006,-4.22 -3.444,-3.908c-0.876,0.624 -1.662,1.439 -2.205,2.486c-0.129,0.248 3.191,3.188 3.092,3.462c-0.106,0.293 -3.628,-2.078 -3.696,-1.754c-0.113,0.539 -0.169,1.123 -0.158,1.754c0.025,1.381 1.397,1.802 0.098,3.883c-0.661,1.059 8.503,2.854 8.485,3.486c-0.015,0.561 -8.694,-0.245 -8.73,0.967c-0.019,0.667 -0.038,1.355 -0.056,2.053c-0.006,0.213 7.113,0.685 7.108,0.9c-0.008,0.335 -7.14,0.414 -7.147,0.752c-0.017,0.826 -0.011,1.658 -0.041,2.482c-0.04,1.075 7.471,0.767 7.469,1.132c-0.002,0.272 -7.463,-0.135 -7.484,0.778c-0.008,0.36 0,0.717 0.001,1.068c0.002,0.475 2.968,0.651 2.975,1.106c0.004,0.197 -2.933,-0.174 -2.951,0.875c-0.006,0.395 0.016,0.779 0.033,1.151c0.068,1.503 7.363,0.705 7.373,0.926c0.024,0.527 -7.293,0.778 -7.257,1.241c0.048,0.609 0.106,1.158 0.178,1.63Zm13.438,-29.16c-1.726,-1.691 -4.2,-2.867 -5.803,-2.713c-0.647,0.062 -1.456,0.227 -2.3,0.528c0.004,0.031 0.009,0.065 0.015,0.096c0.062,0.321 0.216,0.848 0.395,1.436c0.351,1.152 0.797,2.528 0.876,3.073c0.021,0.143 0.015,0.248 -0.002,0.307c-0.029,0.103 -0.092,0.158 -0.154,0.188c-0.073,0.035 -0.161,0.046 -0.263,0.014c-0.07,-0.022 -0.158,-0.072 -0.256,-0.154c-0.441,-0.372 -1.257,-1.571 -1.967,-2.541c-0.338,-0.462 -0.651,-0.87 -0.885,-1.095c-0.036,-0.036 -0.082,-0.071 -0.116,-0.096c-0.785,0.574 -1.492,1.31 -1.996,2.241c0.036,0.051 0.094,0.13 0.152,0.198c0.193,0.225 0.487,0.528 0.813,0.857c0.744,0.75 1.651,1.631 1.953,2.037c0.076,0.102 0.12,0.187 0.137,0.243c0.024,0.081 0.015,0.148 -0.002,0.196c-0.03,0.083 -0.088,0.145 -0.185,0.175c-0.057,0.018 -0.162,0.023 -0.302,-0.022c-0.404,-0.132 -1.419,-0.736 -2.267,-1.213c-0.358,-0.201 -0.763,-0.393 -0.977,-0.491c-0.079,0.455 -0.117,0.942 -0.108,1.462c0.01,0.514 0.227,0.882 0.398,1.266c0.153,0.344 0.276,0.697 0.257,1.137c-0.019,0.424 -0.171,0.934 -0.584,1.6c0.01,0.016 0.03,0.044 0.049,0.063c0.111,0.111 0.301,0.224 0.545,0.343c0.231,0.113 0.507,0.228 0.816,0.345c1.976,0.745 5.246,1.544 6.469,2.06c0.255,0.108 0.432,0.212 0.516,0.297c0.092,0.093 0.119,0.189 0.117,0.269c-0.003,0.112 -0.086,0.271 -0.343,0.344c-0.423,0.119 -1.608,0.13 -2.976,0.133c-1.734,0.004 -3.772,0.002 -4.846,0.249c-0.202,0.046 -0.366,0.099 -0.479,0.167c-0.023,0.014 -0.044,0.029 -0.061,0.045c-0.011,0.01 -0.025,0.016 -0.025,0.029c-0.018,0.606 -0.035,1.228 -0.051,1.86c0.438,0.058 1.988,0.258 3.323,0.386c1.628,0.157 3.256,0.321 3.563,0.43c0.193,0.068 0.219,0.214 0.217,0.276c-0.001,0.059 -0.02,0.121 -0.071,0.179c-0.04,0.045 -0.146,0.112 -0.326,0.152c-0.522,0.117 -1.967,0.203 -3.412,0.287c-1.119,0.066 -2.237,0.131 -2.912,0.212c-0.163,0.02 -0.33,0.053 -0.429,0.074c-0.014,0.774 -0.01,1.553 -0.038,2.325c0.007,0.008 0.033,0.037 0.055,0.053c0.091,0.063 0.225,0.116 0.39,0.164c0.907,0.267 2.656,0.353 4.145,0.418c1.174,0.051 2.192,0.089 2.552,0.177c0.122,0.03 0.198,0.076 0.237,0.113c0.067,0.064 0.09,0.137 0.09,0.207c-0.001,0.073 -0.046,0.231 -0.271,0.284c-0.209,0.049 -0.81,0.069 -1.589,0.08c-1.524,0.022 -3.761,0.023 -4.97,0.24c-0.236,0.042 -0.429,0.091 -0.563,0.153c-0.033,0.016 -0.073,0.043 -0.091,0.057c-0.007,0.327 -0.001,0.653 0.001,0.974c0.032,0.019 0.098,0.057 0.152,0.079c0.276,0.109 0.706,0.201 1.137,0.294c0.544,0.117 1.087,0.238 1.366,0.379c0.226,0.114 0.318,0.272 0.32,0.407c0.002,0.09 -0.033,0.202 -0.184,0.264c-0.09,0.038 -0.351,0.058 -0.691,0.067c-0.496,0.015 -1.192,0.029 -1.672,0.194c-0.219,0.075 -0.4,0.166 -0.404,0.358c-0.006,0.389 0.015,0.769 0.032,1.136c0.004,0.086 0.062,0.151 0.143,0.211c0.13,0.096 0.315,0.17 0.539,0.232c1.189,0.33 3.367,0.275 4.85,0.231c0.588,-0.018 1.069,-0.034 1.345,-0.027c0.159,0.004 0.267,0.021 0.315,0.039c0.147,0.055 0.178,0.164 0.182,0.24c0.003,0.071 -0.017,0.144 -0.071,0.213c-0.047,0.059 -0.141,0.128 -0.291,0.183c-0.528,0.194 -2.012,0.356 -3.495,0.508c-1.264,0.129 -2.527,0.254 -3.165,0.396c-0.082,0.018 -0.167,0.045 -0.225,0.065c0.045,0.55 0.1,1.047 0.165,1.48c0.133,0.877 0.276,1.704 0.475,2.467c0.206,-0.035 0.849,-0.151 1.397,-0.308c1.08,-0.308 2.369,-0.719 2.89,-0.754c0.15,-0.01 0.26,0.012 0.324,0.044c0.077,0.04 0.125,0.096 0.151,0.161c0.025,0.059 0.034,0.132 0.007,0.217c-0.021,0.064 -0.077,0.156 -0.178,0.261c-0.374,0.387 -1.512,1.156 -2.443,1.817c-0.529,0.376 -0.99,0.709 -1.173,0.91c0.996,1.526 2.719,2.507 5.933,2.754c3.519,0.271 5.429,-0.793 6.437,-2.391c-0.236,-0.179 -0.76,-0.469 -1.358,-0.794c-1.069,-0.58 -2.369,-1.254 -2.811,-1.586c-0.149,-0.112 -0.222,-0.218 -0.241,-0.277c-0.023,-0.073 -0.016,-0.138 0.006,-0.193c0.026,-0.065 0.079,-0.132 0.184,-0.167c0.058,-0.019 0.163,-0.029 0.309,-0.013c0.552,0.061 1.962,0.46 3.141,0.77c0.668,0.176 1.256,0.325 1.549,0.352c0.187,-0.767 0.268,-1.567 0.294,-2.344c0.005,-0.145 0.01,-0.292 0.016,-0.441c-0.063,-0.023 -0.161,-0.057 -0.256,-0.081c-0.471,-0.121 -1.254,-0.252 -2.037,-0.385c-1.029,-0.175 -2.057,-0.356 -2.424,-0.513c-0.116,-0.051 -0.189,-0.11 -0.225,-0.158c-0.049,-0.064 -0.065,-0.131 -0.063,-0.194c0.004,-0.096 0.078,-0.246 0.304,-0.336c0.379,-0.152 1.42,-0.29 2.463,-0.426c0.874,-0.113 1.749,-0.227 2.198,-0.356c0.048,-0.013 0.101,-0.034 0.139,-0.05l0.033,-0.773l0.032,-0.746c-0.512,-0.177 -2.239,-0.543 -3.966,-0.914c-1.903,-0.408 -3.805,-0.822 -4.163,-0.988c-0.184,-0.085 -0.206,-0.227 -0.204,-0.283c0.004,-0.08 0.036,-0.157 0.122,-0.215c0.04,-0.027 0.12,-0.059 0.243,-0.064c0.724,-0.029 4.416,0.727 6.634,0.932c0.505,0.047 0.93,0.065 1.218,0.034c0.058,-0.006 0.124,-0.022 0.171,-0.034c-0.133,-0.49 -0.115,-0.934 -0.055,-1.345c0.05,-0.343 0.131,-0.66 0.16,-0.96c-0.082,-0.035 -0.222,-0.093 -0.366,-0.141c-1.352,-0.45 -4.764,-1.249 -4.967,-1.301c-0.32,-0.083 -0.486,-0.17 -0.539,-0.224c-0.085,-0.087 -0.096,-0.177 -0.081,-0.254c0.013,-0.07 0.06,-0.167 0.2,-0.224c0.158,-0.066 0.656,-0.108 1.319,-0.13c1.432,-0.049 3.694,-0.045 4.724,-0.27c0.025,-0.006 0.018,-0.033 0.019,-0.058c0.003,-0.082 -0.013,-0.178 -0.035,-0.281c-0.069,-0.34 -0.178,-0.735 -0.125,-1.017c-0.007,-0.008 -0.018,-0.021 -0.027,-0.029c-0.027,-0.023 -0.061,-0.045 -0.101,-0.067c-0.17,-0.096 -0.423,-0.179 -0.724,-0.256c-1.062,-0.272 -2.692,-0.45 -3.665,-0.626c-0.313,-0.057 -0.563,-0.115 -0.714,-0.174c-0.104,-0.04 -0.176,-0.087 -0.217,-0.13c-0.111,-0.113 -0.139,-0.226 -0.13,-0.323c0.009,-0.1 0.06,-0.203 0.178,-0.287c0.156,-0.111 0.509,-0.206 0.977,-0.261c1.301,-0.15 3.572,-0.077 4.43,0.083c0.019,0.004 0.037,0.008 0.055,0.011c0.007,-0.594 0.016,-1.546 0.033,-1.985c0.013,-0.352 -0.26,-0.551 -0.625,-0.691c-0.692,-0.269 -1.717,-0.304 -2.45,-0.342c-0.316,-0.016 -0.581,-0.033 -0.753,-0.063c-0.105,-0.019 -0.184,-0.045 -0.236,-0.073c-0.133,-0.073 -0.175,-0.178 -0.174,-0.278c0.001,-0.15 0.095,-0.304 0.333,-0.391c0.265,-0.097 0.795,-0.133 1.396,-0.17c0.707,-0.044 1.522,-0.092 2.061,-0.298c0.261,-0.1 0.46,-0.223 0.462,-0.452c0.007,-0.651 -0.011,-1.287 -0.026,-1.901c-0.003,-0.005 -0.014,-0.02 -0.023,-0.029c-0.029,-0.028 -0.068,-0.053 -0.113,-0.079c-0.154,-0.085 -0.376,-0.159 -0.651,-0.227c-1.394,-0.343 -4.047,-0.49 -6.304,-0.609c-1.754,-0.092 -3.274,-0.169 -3.815,-0.3c-0.148,-0.036 -0.245,-0.086 -0.293,-0.128c-0.077,-0.067 -0.104,-0.144 -0.106,-0.216c-0.003,-0.099 0.054,-0.254 0.283,-0.329c0.305,-0.1 1.188,-0.15 2.339,-0.184c2.262,-0.067 5.594,-0.097 7.433,-0.499c0.369,-0.08 0.675,-0.175 0.892,-0.291c0.142,-0.076 0.248,-0.144 0.26,-0.248c0.115,-1.048 -0.149,-1.98 -0.266,-2.742c-0.054,-0.349 -0.159,-0.695 -0.305,-1.035c-0.16,0.021 -0.575,0.08 -0.961,0.171c-1.25,0.294 -3.127,0.836 -3.9,0.936c-0.175,0.023 -0.306,0.021 -0.382,0.004c-0.104,-0.024 -0.165,-0.078 -0.2,-0.13c-0.053,-0.077 -0.073,-0.169 -0.043,-0.279c0.019,-0.069 0.068,-0.158 0.155,-0.255c0.362,-0.403 1.585,-1.159 2.571,-1.812c0.378,-0.251 0.72,-0.486 0.957,-0.68c0.073,-0.06 0.148,-0.135 0.198,-0.189Z")
//          .style("stroke", "#731e27")
          .style("fill", "#731e27")
          .style("stroke-miterlimit", 1.41421)
          .style("stroke-linejoin", "round")
          .style("fill-rule", "evenodd")
          .style("clio-rule", "evenodd")
          ;

        mitochondria
          .attr("transform-origin", function() {
            bbox = this.getBBox();
            return bbox.x+" "+bbox.y;})//bbox
          .attr("transform", "translate(150 0) scale(3)")
    };

	function getRandom(size){
		return Math.floor(Math.random() * size);
	};

	function animateApp(){
    if (d3.select("#sugar").attr("height") <= 3.2) {
      clearInterval(animationInterval);
      return;
    }
   d3.select("#sugar").transition()
     .duration(100) //same as interval
     .ease(d3.easeLinear)
     .attr("height", function() {return d3.select(this).attr("height") -160/50;})
     .attr("transform", function() {return "translate(0 "+(150-d3.select(this).attr("height")+3.2)+")";})
     ;
    // add animation
    var pathNode = _app.path.node();
    var pathLength = pathNode.getTotalLength();
	//	console.log(pathLength);


    // create animation object and place it to the start of the path
//    var animatedObject =
//		_app.paper.append('circle')
//			.attr('class', 'animated-object')
//			.attr('r', 5)
//			.attr({
//					transform: function () {
//							var p = pathNode.getPointAtLength(0);
//							return "translate(" + [p.x, p.y] + ")";
//					}
//			});

  var animatedObject =
			_app.paper.append('rect');
      animatedObject
			  .attr('class', 'animated-object')
				.attr('width', 16)
				.attr('height', 10)
        .attr({
            transform: function () {
                var p = pathNode.getPointAtLength(0);
                return "translate(" + [p.x-5, p.y-5] + ")";
            }
        });
			//	console.log(animatedObject);
      var zoom = d3.zoom()
          .on("start", zoomStarted)
          .on("end", zoomEnded)
          .on("zoom", zoomed);
          function zoomStarted() {
            console.log('zoomStarted() - transform ');
          }

          function zoomEnded() {
            console.log('zoomEnded() - transform ');
          }

          function zoomed(event, d) {
            console.log('zoomed() - applying transform ');
            console.log(event.transform);
            console.log(this);
//            d3.select(this).attr("transform", event.transform);
            //below is actually applying the transform, comment it out and observe!!
//            view.attr("transform", d3.event.transform);
          }

    animatedObject
      .transition()
//			.duration( getRandom(10000) )
			.duration( 5000 )
			//.ease("linear")
			.ease(d3.easeLinear)
      .attrTween("transform", function (d, i) {
          return function (t) {
              var spot = pathLength * t;
              var spot2 = (spot+2 < pathLength ? spot+2 : spot-2);
              var p = pathNode.getPointAtLength(spot);
							var p2 = pathNode.getPointAtLength(spot2);
							angle = Math.atan2( (p2.y - p.y), (p2.x - p.x) );
							return "translate(" + [p.x-8, p.y-5] + ") rotate(" + angle*180/Math.PI + " 8 5)";
          }.bind(this)
      })
	//		.each('end', function(){
			.on('end', function(){
        d3.select("#atp").transition()
          .duration(100) //same as interval
          .ease(d3.easeLinear)
          .attr("height", function() {return +d3.select(this).attr("height") +160/100;})
          .attr("transform", function() {return "translate(0 "+(75-d3.select(this).attr("height")-1.6)+")";})
          ;


        d3.select( this )
//           .style('opacity', 0.2)
// //          .attr('transform', "translate(100 100)")
//           .transition()
//           .duration(500)
// 					//.attr('r', 32)
// 					.attr('width', 64)
// 					.attr('height', 40)
// //          .attr("transform", function() {
// //            return d3.zoomTransform(this).translate(0, 0).scale(1);
// //          })
// //          .call(function () {zoom.transform(d3.select(this), zoom.translateBy(d3.select(this), 500, 500));})
// //					.attr('transform', function() {
// //						var p = pathNode.getPointAtLength(pathLength);
// //						return "translate(" + (p.x-32)+" "+ (p.y-20) + ")";
// //					})
//           .style('opacity', 0.0)
          .remove();
      });
	};

  function getRandom(size){
    return Math.floor(Math.random() * size);
  };

	var animationInterval;
	$('#start').click(function(e){
		e.preventDefault();
		animationInterval = setInterval(animateApp, 100);
		//animateApp();
	});

	$('#stop').click(function(e){
		e.preventDefault();
		clearInterval(animationInterval);
	});

//	var i = setInterval(animateApp, 100);

});

</script>

</head>

<body>
<div id="page">

	<div id="paper"></div>
	<span id="start" class="btn animate-btn">Start Animation</span>
	<span id="stop" class="btn animate-btn">Stop Animation</span>
</body>
</html>
